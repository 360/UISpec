<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>UISpec: /Users/brianknorr/Dev/UISpec/UISpec/src/dsl/UIFilter.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>/Users/brianknorr/Dev/UISpec/UISpec/src/dsl/UIFilter.m</h1><a href="_u_i_filter_8m.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#import "<a class="code" href="_u_i_filter_8h.html">UIFilter.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#import "<a class="code" href="_u_i_query_8h.html">UIQuery.h</a>"</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="keyword">@implementation </span><a class="code" href="interface_u_i_filter.html">UIFilter</a>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 <span class="keyword">@synthesize</span> <a class="code" href="interface_u_i_filter.html#06d0029b4390346fa60c29bfbc613176">query</a>, <a class="code" href="interface_u_i_filter.html#93cfb1768db7fdd9e63ef8f6c8ddaae2">redoer</a>, <a class="code" href="interface_u_i_filter.html#89702eeb9d3f21e8b3f02adee3153c25">redo</a>;
<a name="l00007"></a>00007 
<a name="l00008"></a><a class="code" href="interface_u_i_filter.html#21d21f832f27d79435736bb3410605fb">00008</a> +(id)withQuery:(<a class="code" href="interface_u_i_query.html">UIQuery</a> *)query {
<a name="l00009"></a>00009         <span class="keywordflow">return</span> [<a class="code" href="interface_u_i_redoer.html">UIRedoer</a> <a class="code" href="interface_recordable.html#57237aa30eb33aae00eb023a00be6de6">withTarget</a>:[[[<a class="code" href="interface_u_i_filter.html">UIFilter</a> alloc] initWithQuery:query] autorelease]];
<a name="l00010"></a>00010 }
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="interface_u_i_filter.html#0ab9e24fefd653b4f82e7a6204137593">00012</a> -(id)initWithQuery:(<a class="code" href="interface_u_i_query.html">UIQuery</a> *)_query {
<a name="l00013"></a>00013         <span class="keywordflow">if</span> (<span class="keyword">self</span> = [super init]) {
<a name="l00014"></a>00014                 <span class="keyword">self</span>.query = _query;
<a name="l00015"></a>00015         }
<a name="l00016"></a>00016         <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00017"></a>00017 }
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="interface_u_i_filter.html#b81f250b5f8f217dd6ef058d1d339c1a">00019</a> - (NSMethodSignature *)methodSignatureForSelector:(<span class="keywordtype">SEL</span>)aSelector {
<a name="l00020"></a>00020         NSString *selector = NSStringFromSelector(aSelector);
<a name="l00021"></a>00021         NSRange whereIsSet = [selector rangeOfString:@":"];
<a name="l00022"></a>00022         <span class="keywordflow">if</span> (whereIsSet.length != 0) {
<a name="l00023"></a>00023                 NSArray *selectors = [NSStringFromSelector(aSelector) componentsSeparatedByString:@":"];
<a name="l00024"></a>00024                 NSMutableString *signature = [NSMutableString stringWithString:@"@@:"];
<a name="l00025"></a>00025                 <span class="keywordflow">for</span> (NSString *selector in selectors) {
<a name="l00026"></a>00026                         <span class="keywordflow">if</span> ([selector length] &gt; 0) {
<a name="l00027"></a>00027                                 [signature appendString:@"@"];
<a name="l00028"></a>00028                         }
<a name="l00029"></a>00029                 }
<a name="l00030"></a>00030                 <span class="keywordflow">return</span> [NSMethodSignature signatureWithObjCTypes:[signature cStringUsingEncoding:NSUTF8StringEncoding]];} 
<a name="l00031"></a>00031         <span class="keywordflow">else</span> {
<a name="l00032"></a>00032                 <span class="keywordflow">return</span> [<span class="keyword">super</span> methodSignatureForSelector:aSelector];
<a name="l00033"></a>00033         }
<a name="l00034"></a>00034 }
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="interface_u_i_filter.html#860574d487db9f6dffcf05ddb73b85ab">00036</a> - (void)forwardInvocation:(NSInvocation *)anInvocation {
<a name="l00037"></a>00037         NSMutableString *selector = [NSMutableString stringWithString:NSStringFromSelector([anInvocation selector])];
<a name="l00038"></a>00038         NSArray *selectors = [selector componentsSeparatedByString:@":"];
<a name="l00039"></a>00039         NSMutableArray *array = [NSMutableArray array];
<a name="l00040"></a>00040         NSDate *start = [NSDate date];
<a name="l00041"></a>00041         <span class="keywordflow">while</span> ([start timeIntervalSinceNow] &gt; (0 - [query timeout])) {
<a name="l00042"></a>00042                 <span class="keywordflow">for</span> (UIView *view in [query views]) {
<a name="l00043"></a>00043                         BOOL matches = YES;
<a name="l00044"></a>00044                         <span class="keywordtype">int</span> i = 2;
<a name="l00045"></a>00045                         <span class="keywordtype">id</span> value = nil;
<a name="l00046"></a>00046                         <span class="keywordflow">for</span> (NSString *key in selectors) {
<a name="l00047"></a>00047                                 <span class="keywordflow">if</span> (![key isEqualToString:<span class="stringliteral">@""</span>]) {
<a name="l00048"></a>00048                                         <span class="keywordtype">SEL</span> selector = NSSelectorFromString(key);
<a name="l00049"></a>00049                                         <span class="keywordflow">if</span> (![view respondsToSelector:selector]) {
<a name="l00050"></a>00050                                                 matches = NO;
<a name="l00051"></a>00051                                                 <span class="keywordflow">continue</span>;
<a name="l00052"></a>00052                                         }
<a name="l00053"></a>00053                                         [anInvocation getArgument:&amp;value atIndex:i++];
<a name="l00054"></a>00054                                         NSString *returnType = [NSString stringWithFormat:@"%s", [[view methodSignatureForSelector:selector] methodReturnType]];
<a name="l00055"></a>00055                                         <span class="keywordflow">if</span> ([returnType isEqualToString:<span class="stringliteral">@"</span><span class="stringliteral">@"]) {</span>
<a name="l00056"></a>00056 <span class="stringliteral">                                                if ([value isKindOfClass:[NSString class]]) {</span>
<a name="l00057"></a>00057 <span class="stringliteral">                                                        if ([[view performSelector:selector] rangeOfString:value].length == 0) {</span>
<a name="l00058"></a>00058 <span class="stringliteral">                                                                matches = NO;</span>
<a name="l00059"></a>00059 <span class="stringliteral">                                                                continue;</span>
<a name="l00060"></a>00060 <span class="stringliteral">                                                        }</span>
<a name="l00061"></a>00061 <span class="stringliteral">                                                } else if (![[view performSelector:selector] isEqual:value]) {</span>
<a name="l00062"></a>00062 <span class="stringliteral">                                                        matches = NO;</span>
<a name="l00063"></a>00063 <span class="stringliteral">                                                        continue;</span>
<a name="l00064"></a>00064 <span class="stringliteral">                                                }</span>
<a name="l00065"></a>00065 <span class="stringliteral">                                        } else {</span>
<a name="l00066"></a>00066 <span class="stringliteral">                                                if (![view performSelector:selector] == value) {</span>
<a name="l00067"></a>00067 <span class="stringliteral">                                                        matches = NO;</span>
<a name="l00068"></a>00068 <span class="stringliteral">                                                        continue;</span>
<a name="l00069"></a>00069 <span class="stringliteral">                                                }</span>
<a name="l00070"></a>00070 <span class="stringliteral">                                        }</span>
<a name="l00071"></a>00071 <span class="stringliteral">                                }</span>
<a name="l00072"></a>00072 <span class="stringliteral">                        }</span>
<a name="l00073"></a>00073 <span class="stringliteral">                        if (matches) {</span>
<a name="l00074"></a>00074 <span class="stringliteral">                                [array addObject:view];</span>
<a name="l00075"></a>00075 <span class="stringliteral">                        }</span>
<a name="l00076"></a>00076 <span class="stringliteral">                }</span>
<a name="l00077"></a>00077 <span class="stringliteral">                if (array.count &gt; 0) {</span>
<a name="l00078"></a>00078 <span class="stringliteral">                        break;</span>
<a name="l00079"></a>00079 <span class="stringliteral">                } else {</span>
<a name="l00080"></a>00080 <span class="stringliteral">                        [self redo];</span>
<a name="l00081"></a>00081 <span class="stringliteral">                }</span>
<a name="l00082"></a>00082 <span class="stringliteral">        }</span>
<a name="l00083"></a>00083 <span class="stringliteral">        id newQuery = [UIQuery withViews:array className:[query className]];</span>
<a name="l00084"></a>00084 <span class="stringliteral">        [anInvocation setReturnValue:&amp;newQuery];</span>
<a name="l00085"></a>00085 <span class="stringliteral">}</span>
<a name="l00086"></a>00086 <span class="stringliteral"></span>
<a name="l00087"></a>00087 <span class="stringliteral">-(id)redo {</span>
<a name="l00088"></a>00088 <span class="stringliteral">        if (redoer != nil) {</span>
<a name="l00089"></a>00089 <span class="stringliteral">                UIRedoer *redone = [redoer redo];</span>
<a name="l00090"></a>00090 <span class="stringliteral">                redoer.target = redone.target;</span>
<a name="l00091"></a>00091 <span class="stringliteral">                self.query = [[redoer play] query];</span>
<a name="l00092"></a>00092 <span class="stringliteral">        }</span>
<a name="l00093"></a>00093 <span class="stringliteral">}</span>
<a name="l00094"></a>00094 <span class="stringliteral"></span>
<a name="l00095"></a><a class="code" href="interface_u_i_filter.html#422ede294bd61cb2da1867c26fd0bb2b">00095</a> <span class="stringliteral">-(void)dealloc {</span>
<a name="l00096"></a>00096 <span class="stringliteral">        self.query = nil;</span>
<a name="l00097"></a>00097 <span class="stringliteral">        self.redoer = nil;</span>
<a name="l00098"></a>00098 <span class="stringliteral">        [super dealloc];</span>
<a name="l00099"></a>00099 <span class="stringliteral">}</span>
<a name="l00100"></a>00100 <span class="stringliteral"></span>
<a name="l00101"></a>00101 <span class="stringliteral">@end</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Aug 2 20:31:36 2009 for UISpec by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
